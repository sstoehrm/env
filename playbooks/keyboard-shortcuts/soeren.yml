---
# Keyboard shortcuts for Soeren's custom setup
# Works on: Ubuntu GNOME, Fedora GNOME
# Run with: ansible-playbook playbooks/keyboard-shortcuts/soeren.yml

- name: Soeren's Keyboard Shortcuts
  hosts: localhost
  vars:
    user: 'soeren'
    user_home: '/home/soeren'

  tasks:
    - name: Gather facts
      setup:

    - name: Detect distribution
      set_fact:
        is_ubuntu: "{{ ansible_facts['distribution'] == 'Ubuntu' or ansible_facts['distribution'] == 'Debian' }}"
        is_fedora: "{{ ansible_facts['distribution'] == 'Fedora' or ansible_facts['distribution'] == 'RedHat' or ansible_facts['distribution'] == 'CentOS' }}"

    - name: Determine default terminal based on distribution
      set_fact:
        default_terminal: "{{ 'ptyxis' if (is_ubuntu and ansible_facts['distribution_version'] is version('25.10', '>=')) else 'gnome-terminal' }}"

    - name: Determine terminal based on installation choice and distribution
      set_fact:
        terminal: "{{ 'tilix' if hostvars['localhost']['should_install_tilix'] | default(false) else default_terminal }}"

    - name: Set browser command based on distribution
      set_fact:
        browser_cmd: "{{ 'chromium' if is_ubuntu else 'flatpak run org.chromium.Chromium' if is_fedora else 'chromium' }}"

    - name: Set file manager for GNOME
      set_fact:
        file_manager: 'nautilus'

    - name: Display environment
      debug:
        msg:
          - "Configuring Soeren's keyboard shortcuts"
          - "Distribution: {{ ansible_facts['distribution'] }} {{ ansible_facts['distribution_version'] }}"
          - "Terminal: {{ terminal }}"
          - "Browser: {{ browser_cmd }}"
          - "File Manager: {{ file_manager }}"

    - name: Set GNOME custom keyboard shortcuts
      shell: |
        # Terminal launcher (Super+Return)
        dconf write /org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom0/name "'Launch Terminal'"
        dconf write /org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom0/command "'{{ terminal }}'"
        dconf write /org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom0/binding "'<Super>Return'"

        # Browser launcher (Super+Shift+B)
        dconf write /org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom1/name "'Launch Browser'"
        dconf write /org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom1/command "'{{ browser_cmd }}'"
        dconf write /org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom1/binding "'<Super><Shift>b'"

        # File manager (Super+Shift+F)
        dconf write /org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom2/name "'Launch File Manager'"
        dconf write /org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom2/command "'{{ file_manager }}'"
        dconf write /org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom2/binding "'<Super><Shift>f'"

        # Neovim (Super+Shift+N)
        dconf write /org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom3/name "'Launch Neovim'"
        dconf write /org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom3/command "'{{ terminal }} -- nvim'"
        dconf write /org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom3/binding "'<Super><Shift>n'"

        # Lazygit (Super+Shift+G)
        dconf write /org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom4/name "'Launch Lazygit'"
        dconf write /org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom4/command "'{{ terminal }} -- {{ user_home }}/.local/bin/lazygit'"
        dconf write /org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom4/binding "'<Super><Shift>g'"

        # Close window (Super+W)
        dconf write /org/gnome/desktop/wm/keybindings/close "['<Super>w']"

        # Toggle fullscreen (Super+F)
        dconf write /org/gnome/desktop/wm/keybindings/toggle-fullscreen "['<Super>f']"

        # Switch workspaces (Super+1/2/3/4)
        dconf write /org/gnome/desktop/wm/keybindings/switch-to-workspace-1 "['<Super>1']"
        dconf write /org/gnome/desktop/wm/keybindings/switch-to-workspace-2 "['<Super>2']"
        dconf write /org/gnome/desktop/wm/keybindings/switch-to-workspace-3 "['<Super>3']"
        dconf write /org/gnome/desktop/wm/keybindings/switch-to-workspace-4 "['<Super>4']"

        # Move window to workspace (Super+Shift+1/2/3/4)
        dconf write /org/gnome/desktop/wm/keybindings/move-to-workspace-1 "['<Super><Shift>1']"
        dconf write /org/gnome/desktop/wm/keybindings/move-to-workspace-2 "['<Super><Shift>2']"
        dconf write /org/gnome/desktop/wm/keybindings/move-to-workspace-3 "['<Super><Shift>3']"
        dconf write /org/gnome/desktop/wm/keybindings/move-to-workspace-4 "['<Super><Shift>4']"

        # Register custom keybindings
        dconf write /org/gnome/settings-daemon/plugins/media-keys/custom-keybindings "['/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom0/', '/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom1/', '/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom2/', '/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom3/', '/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom4/']"
      args:
        executable: /bin/bash

    - name: Soeren's shortcuts configured
      debug:
        msg:
          - "Soeren's keyboard shortcuts configured successfully"
          - ""
          - "Shortcuts:"
          - "  Super+Return         → Terminal ({{ terminal }})"
          - "  Super+Shift+B        → Browser"
          - "  Super+Shift+F        → File Manager ({{ file_manager }})"
          - "  Super+Shift+N        → Neovim"
          - "  Super+Shift+G        → Lazygit"
          - "  Super+W              → Close window"
          - "  Super+F              → Toggle fullscreen"
          - "  Super+1/2/3/4        → Switch to workspace 1/2/3/4"
          - "  Super+Shift+1/2/3/4  → Move window to workspace 1/2/3/4"
